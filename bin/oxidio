#!/usr/bin/env php
<?php
/**
 * Copyright (C) oxidio. See LICENSE file for license details.
 */

namespace Oxidio;

use OxidEsales\Eshop\Core\{
    Module,
    Registry
};
use fn;

call_user_func(static function () {
    $file = file_exists($file = __DIR__ . '/../../../autoload.php') ? $file : __DIR__ . '/../vendor/autoload.php';
    /** @noinspection PhpIncludeInspection */
    exit(call_user_func(require $file, static function () {
        $cli = fn\cli([
            'cli.name' => 'oxidio/oxidio',
            'cli.commands.default' => false,
        ]);

        $cli->command('modules', static function () {
            $dir = Registry::getConfig()->getModulesDir();
            foreach (oxNew(Module\ModuleList::class)->getModulesFromDir($dir) as $module) {
                yield $module->getId();
            }
        });

        $cli->command('shop', static function ($property, $shop = null) {
            shop($shop)->modules['oxidio/module-bar']->active = false;
            yield (object)shop($shop)->$property;
        }, ['property']);

        $cli->command('test:dml', require 'test-dml.php', ['action', 'name']);

        return $cli->run();
    }));
});
